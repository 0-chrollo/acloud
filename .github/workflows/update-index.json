
name: Update index.json

on:
  push:
    paths:
      - 'src/posts/**/*.md'

jobs:
  update-index:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v3

      - name: Generate index.json
        run: |
          cd src/posts
          echo '[' > index.json
          for file in *.md; do
            title=$(grep -m 1 '^title:' "$file" | cut -d ':' -f 2 | sed 's/^ *//')
            date=$(grep -m 1 '^date:' "$file" | cut -d ':' -f 2 | sed 's/^ *//')
            author=$(grep -m 1 '^author:' "$file" | cut -d ':' -f 2 | sed 's/^ *//')
            echo "  { \"file\": \"$file\", \"title\": \"$title\", \"date\": \"$date\", \"author\": \"$author\" }," >> index.json
          done
          sed -i '$ s/,$//' index.json
          echo ']' >> index.json

      - name: Commit and push changes
        run: |
          git config --global user.name "GitHub Actions"
          git config --global user.email "actions@github.com"
          git add src/posts/index.json
          git commit -m "Automatically update index.json"
          git push
